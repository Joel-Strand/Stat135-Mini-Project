---
title: "Olympic Rowing Predictions"
subtitle: "Stat135 - Predicting Paris 2024 Data Challenge"
author: "Joel, Lauren, Mia, Sam"
format: pdf
---

```{r}
#| label: setup
#| include: false

knitr::opts_chunk$set(echo = TRUE, eval=F)

library(googlesheets4)
library(mosaic)
```

## Import the data
```{r}
#| label: import-data
knitr::opts_chunk$set(echo = TRUE, eval=F)

library(googlesheets4)
library(mosaic)
library(tidyverse)
olympic_dat0 <- readRDS(file=url("https://kcorreia.people.amherst.edu/Stat135/project_scull.Rds")) |>
  separate(Time, into=c("minute", "second"), sep=":", remove=F) |>
  mutate(across(c("minute", "second"), ~parse_number(.))
         , Time_Minutes = minute + (second/60)
         , RacingLane = parse_number(`Racing Line`)
         , RacingLane_f = factor(case_when(RacingLane %in% c(6) | is.na(RacingLane) ~ "Other"
                                    , RacingLane == 1 ~ "Lane 1"
                                    , RacingLane == 2 ~ "Lane 2"
                                    , RacingLane == 3 ~ "Lane 3 (Referent) "
                                    , RacingLane == 4 ~ "Lane 4"
                                    , RacingLane == 5 ~ "Lane 5")
                                 , levels=c("Lane 3 (Referent)", "Lane 1", "Lane 2", "Lane 4", "Lane 5", "Other")))

# check derivation
count(olympic_dat0, RacingLane, RacingLane_f)

# check numbers in each group of new variable
count(olympic_dat0, RacingLane_f)

```

## Descriptive Statistics

```{r}
#| label: desc-stats
 
# e.g, can use tally to compute descriptive statistics for categorical variables

tally(~RacingLane_f, data=olympic_dat0)

# e.g., can use favstats to compute descriptive statistics for quantitative variables
favstats(~Time_Minutes, data=olympic_dat0)
favstats(~Height, data=olympic_dat0)
favstats(~Weight, data=olympic_dat0)

favstats(Time_Minutes ~ RacingLane_f, data = olympic_dat0)
# e.g., by group
```

## Plot(s)

```{r}
#| label: plotting

# title your plot(s), keeping in mind context and language matter
# be sure to label all axes appropriately 

# see the mosaic cheatsheet, and relevant labs and problem sets for how to
# code the plot you want (using one of the gf_XX functions)
# if you're still stuck or have a question about a particular aspect of the plot,
# come talk to me - I can help you!

gf_boxplot(Time_Minutes ~ RacingLane_f, data = olympic_dat0
           , xlab="Lane"
           , ylab="Time (minutes)"
           , title="Time verses Lane") 

#scatterplots so no concerning features so we can assume linearity for the regression model
gf_point(Time_Minutes ~ Height, data=olympic_dat0) %>% gf_lm(size=1.5,linetype="dashed")
gf_point(Time_Minutes ~ Weight, data=olympic_dat0) %>% gf_lm(size=1.5,linetype="dashed")
```


## Multiple Linear Regression Model 

```{r}
#| label: mlr

# include the code to fit your multiple linear regression model 
# including any checks for relevant assumptions
# and any inferential procedures you did 
# (e.g., hypothesis testing or confidence intervals)
# please use comments to indicate what you're doing

mod <- lm(Time_Minutes ~ Height + Weight, data=olympic_dat0) 
msummary(mod)

#show distribution of the residuals to check for nearly normal
gf_histogram(~resid(mod), color="black"
             , xlab="Residuals"
             , ylab="Time")

#check for equal variance
gf_point(resid(mod) ~ predict(mod), color="black"
         , xlab="Height (m)"
         , ylab="Residual (minutes)") |>
  gf_abline(intercept=0, slope=0, linetype="dashed", color="darkgrey")

#run model with racing lane
mod2 <- lm(Time_Minutes ~ Height + Weight + RacingLane_f + as.factor(OlypmicCity), data=olympic_dat0)
msummary(mod2)
```

### Prediction

```{r}
#| label: predict

# include the code to make your prediction for an athlete who
# is expected to compete in the event this summer


confint(mod, level = 0.95)
confint(mod2, level = 0.95)

  
```
